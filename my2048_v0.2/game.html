<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<body>
	<h1>Escolha o tamanho do tabuleiro:</h1>
	<button id="increase">Maior</button>
	<button id="decrease">Menor</button>
	<p id="tableSizeOutput"></p>
	<canvas id="gameScreen" width="600" height="600"></canvas>

	<script type="module">
		import startGame from './game.js';
		import newKeyboardListner from './keyboard.js';
		import newGraphicCanvas from './graphic.js';

		window.onload = () => {
			const initialTableSize = 4;

			var runningGame = gameInstance(window, initialTableSize);

			var tableSize = {
				value: initialTableSize,
				max: 40,
				min: 2,
				increase() {
					if (this.value < this.max) {
						this.value += 1;

						runningGame.newTableSize(this.value);
					}
				},
				decrease() {
					if (this.value > this.min) {
						this.value -= 1;

						runningGame.newTableSize(this.value);
					}
				}
			};

			const increaseButton = window.document.getElementById("increase");
			const decreaseButton = window.document.getElementById("decrease");

			increaseButton.onclick = () => { tableSize.increase() };
			decreaseButton.onclick = () => { tableSize.decrease() };
		}

		//subject game
		function gameInstance(windowInput, initialSize) {
			const gameGraphic = newGraphicCanvas(windowInput, "gameScreen");
			const gameState = startGame(initialSize);
			const keyboardListner = newKeyboardListner();

			function newTableSize(newSize) {
				const printSize = windowInput.document.getElementById("tableSizeOutput");
				printSize.innerText = `Tamanho atual: ${newSize}x${newSize}.`;

				gameState.resize(newSize);
			}

			function newGame(initialSize) {
				gameState.subscribe(gameGraphic.stateUpdate);
				keyboardListner.subscribe(gameState.move);
				window.requestAnimationFrame(gameGraphic.newFrame);
			}

			newGame(initialSize);
			newTableSize(initialSize);

			return {
				newTableSize
			};
		}

	</script>
</body>

</html>